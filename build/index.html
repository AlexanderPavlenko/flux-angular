<!DOCTYPE html>
<html>
  <head>
  </head>
  <body ng-app="app">
    <app/>
    <script src="vendors.js"></script>
    <script src="main.js"></script>
    <script>
    angular.module('app', ['flux'])
    .store('AppStore', function () {
      return {
        comments: ['foo'],
        handlers: {
          'addComment': 'addComment'
        },
        addComment: function (comment) {
          this.comments.push(comment);
          this.emit('comments.add');
        },
        getComments: function () {
          return this.comments;
        }
      };
    })
    .directive('app', function (AppStore, flux) {
      return {
        restrict: 'E',
        scope: {},
        template: '<form ng-submit="addComment()"><input type="text" ng-model="comment"/></form><ul><li ng-repeat="comment in comments">{{comment}}</li></ul>',
        link: function (scope) {

          scope.comment = '';
          scope.comments = AppStore.getComments();

          scope.addComment = function () {
            flux.dispatch('addComment', scope.comment);
            scope.comment = '';
          };

          scope.$listenTo(AppStore, 'comments.*', function () {
            scope.comments = AppStore.getComments();
          });

        }
      }
    })
    </script>
  </body>
</html>